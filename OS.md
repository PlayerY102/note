# OS note

## 内中断

* 中断信息。中断的意思是指，CPU不再接着（刚执行完的指令）向下执行，而是转去处理这个特殊信息

### 内中断的产生

1. 除法错误，比如执行div指令产生的除法溢出 中断类型码:0
2. 单步执行 中断类型码:1
3. 执行into指令 中断类型码:4
4. 执行int指令 int n

### 中断向量表

* 中断向量，中断处理程序的入口地址。
* 存储N号，偏移地址的内存单元地址为：4N
* 中断处理程序入口的段地址的内存单元的地址为：4N+2

### 中断过程

1. （从中断信息中）取得中断类型码
2. 标志寄存器的值入栈（因为需要改变标志寄存器的值）
3. 设置标志寄存器的第8为TF和第9位IF的值为0
4. cs的内容入栈
5. IP的内容入栈
6. 从内存地址为中断类型码*4和中断类型码*4+2的两个字单元中读取中断IP和CS

### 中断处理程序和iret指令

1. 保存用到的寄存器
2. 处理中断
3. 恢复用到的寄存器
4. 用iret指令返回

* iret指令

1. pop IP
2. pop CS
3. popf

### 单步中断

* 基本上，cpu在执行完一条指令之后，如果检测到标志寄存器的TF位为1，则产生单步中断，引发中断过程。单步中断的中断类型码为1，则它所引发的中断过程如下。

1. 取得中断类型码1
2. 标志寄存器入栈，TF,IF设置为0
3. CS,IP入栈
4. IP=(1*4),CS=(1*4+2)

### 响应中断的特殊情况

* 在执行完向ss寄存器传送数据的指令后，即便是发生中断，CPU也不会响应。如果引发中孤单，要在栈中压入标志寄存器等，而ss改变，sp并未改变，ss:sp指向的不是正确的栈顶。

## int指令

### int 指令

* int n,n为中断类型码，它的功能是引发中断过程

1. 取中断类型码n
2. 标志寄存器入栈
3. CS,IP入栈
4. IP=4*n,CS=4*n+2

